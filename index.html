<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>监控查询</title>
</head>
<body>
  <h1>监控查询</h1>

  <form id="query-form">
    <div id="input-container">
      <label for="name1">Name 1:</label>
      <input type="text" id="name1" name="name1"><br>
    </div>

    <button type="button" onclick="addInput()">Add Input</button>
    <button type="button" onclick="removeInput()">Remove Input</button>
    <button type="button" onclick="executeQuery()">Search</button>
  </form>

  <div id="results"></div>

  <script>
    const { ipcRenderer } = require('electron');

    let inputCounter = 1;

    function addInput() {
      const inputContainer = document.getElementById('input-container');
      const newInput = document.createElement('div');
      newInput.innerHTML = `<label for="name${inputCounter}">Name ${inputCounter}:</label>
                            <input type="text" id="name${inputCounter}" name="name${inputCounter}"><br>`;
      inputContainer.appendChild(newInput);
      inputCounter++;
    }

    function removeInput() {
      if (inputCounter > 1) {
        const inputContainer = document.getElementById('input-container');
        inputContainer.removeChild(inputContainer.lastChild);
        inputCounter--;
      }
    }

    function executeQuery() {
      const inputs = document.querySelectorAll('input[name^="name"]');
      const queries = Array.from(inputs).map(input => {
        const name = input.value.trim();
        return `SELECT boby FROM jkwj WHERE ExtractValue(boby, '/Device/@name') like '%${name}%'`;
      });

      ipcRenderer.send('query-mysql', { queries });
    }

    ipcRenderer.on('query-results', (event, results) => {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      results.forEach((queryResult, index) => {
        const resultDiv = document.createElement('div');
        resultDiv.innerText = `Result ${index + 1}:`;

        queryResult.results.forEach(result => {
          const deviceMatch = result.boby.match(/<Device.*?\/>/);
          if (deviceMatch) {
            const deviceInfo = document.createElement('p');
            deviceInfo.innerText = deviceMatch[0];
            resultDiv.appendChild(deviceInfo);
          }
        });

        resultsDiv.appendChild(resultDiv);
      });
    });

    ipcRenderer.on('query-error', (event, error) => {
      document.getElementById('results').innerText = `Error: ${error}`;
    });
  </script>
</body>
</html>
