<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>监控查询</title>
<style>
html {
  background-image: url('http://106.54.244.161:8090/i/2024/03/28/6604bc07bf495.png');
  background-size: cover;
  background-position: center; 
  background-repeat: no-repeat;
}

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  height: 100vh;
  color: rgb(114, 253, 0);
  position: relative; /* 添加相对定位 */
}

.input-container {
  margin-bottom: 10px;
}

#inputDialog {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

#inputDialog label {
  display: block;
  margin-bottom: 5px;
}

#inputDialog input {
  width: 100%;
  margin-bottom: 10px;
  padding: 5px;
  box-sizing: border-box;
}

#inputDialog button {
  margin-top: 10px;
  padding: 5px 10px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

#inputDialog button:hover {
  background-color: #0056b3;
}

.button-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
}

.button {
  display: block;
  padding: 10px 20px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  text-decoration: none;
  font-size: 16px;
  cursor: pointer;
}

.button:hover {
  background-color: #0056b3;
}

#second-link {
  display: inline-block; /* 设置为内联块级元素 */
  margin-left: 10px; /* 左边距为10px，调整位置 */
  padding: 10px 20px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  text-decoration: none;
  font-size: 16px;
  cursor: pointer;
}

#second-link:hover {
  background-color: #0056b3;
}
</style>
</head>
<body>
<h1>监控查询</h1>

<form id="query-form">
  <div id="input-container">
    <label for="门店1">门店1:</label>
    <input type="text" id="门店1" name="门店1"><br>
  </div>

  <button type="button" onclick="addInput()">增加门店</button>
  <button type="button" onclick="removeInput()">减少门店</button>
  <button type="button" onclick="executeQuery()">导出</button>
  <button type="button" onclick="executeQueryOnly()">查询</button>
  <button type="button" onclick="clearResults()">清除结果</button>
</form>

<div id="results"></div>

<h2>导入监控数据</h2>

<form id="insert-form">
  <label for="newData">新数据:</label>
  <input type="text" id="newData" name="newData">
  <button type="button" onclick="insertData()">插入</button>
</form>

<!-- 数据库连接信息输入对话框 -->
<div id="inputDialog">
  <label for="host">主机地址:</label>
  <input type="text" id="host" placeholder="输入主机地址"><br>
  <label for="user">用户名:</label>
  <input type="text" id="user" placeholder="输入用户名"><br>
  <label for="password">密码:</label>
  <input type="password" id="password" placeholder="输入密码"><br>
  <label for="database">数据库名:</label>
  <input type="text" id="database" placeholder="输入数据库名"><br>
  <button type="button" onclick="changeDbConnection()">确定</button>
</div>

<!-- 右下角按钮 -->
<div class="button-container">
  <a href="https://www.baidu.com" target="_blank" class="button">获得新版本吧</a>
  <a href="https://github.com/8butubb/electron" target="_blank" id="second-link">github</a>
</div>
  <script>
    const { ipcRenderer } = require('electron');

    let inputCounter = 1;

    function addInput() {
      const inputContainer = document.getElementById('input-container');
      const newInput = document.createElement('div');
      inputCounter++;
      newInput.innerHTML = `<label for="门店${inputCounter}">门店 ${inputCounter}:</label>
                            <input type="text" id="门店${inputCounter}" name="门店${inputCounter}"><br>`;
      inputContainer.appendChild(newInput);
    }

    function removeInput() {
      if (inputCounter > 1) {
        const inputContainer = document.getElementById('input-container');
        inputContainer.removeChild(inputContainer.lastChild);
        inputCounter--;
      }
    }

    function executeQuery() {
      const inputs = document.querySelectorAll('input[name^="门店"]');
      const queries = Array.from(inputs).map(input => {
        const name = input.value.trim();
        return `SELECT boby FROM jkwj WHERE ExtractValue(boby, '/Device/@name') like '%${name}%'`;
      });

      ipcRenderer.send('query-mysql', { queries });
    }

    function executeQueryOnly() {
      const inputs = document.querySelectorAll('input[name^="门店"]');
      const queries = Array.from(inputs).map(input => {
        const name = input.value.trim();
        return `SELECT boby FROM jkwj WHERE ExtractValue(boby, '/Device/@name') like '%${name}%'`;
      });

      ipcRenderer.send('query-mysql-only', { queries });
    }

    function insertData() {
      const newData = document.getElementById('newData').value.trim();
      ipcRenderer.send('insert-data', { data: newData });
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
    }

    function openDbConnectionDialog() {
      document.getElementById('inputDialog').style.display = 'block';
    }

    function changeDbConnection() {
      const host = document.getElementById('host').value.trim();
      const user = document.getElementById('user').value.trim();
      const password = document.getElementById('password').value.trim();
      const database = document.getElementById('database').value.trim();

      ipcRenderer.send('change-db-connection', { host, user, password, database });
      document.getElementById('inputDialog').style.display = 'none';
    }

    ipcRenderer.on('query-results', (event, results) => {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      results.forEach((queryResult, index) => {
        const resultDiv = document.createElement('div');
        resultDiv.innerText = `Result ${index + 1}:`;

        queryResult.results.forEach(result => {
          const deviceMatch = result.boby.match(/<Device.*?\/>/);
          if (deviceMatch) {
            const deviceInfo = document.createElement('p');
            deviceInfo.innerText = deviceMatch[0];
            resultDiv.appendChild(deviceInfo);
          }
        });

        resultsDiv.appendChild(resultDiv);
      });
    });

    ipcRenderer.on('query-error', (event, error) => {
      document.getElementById('results').innerText = `Error: ${error}`;
    });

    ipcRenderer.on('insert-result', (event, result) => {
      const insertResultDiv = document.getElementById('insert-result');
      insertResultDiv.innerText = result;
    });

    ipcRenderer.on('db-connection-changed', (event, message) => {
      console.log(message);
      // 可以在这里更新界面提示用户数据库连接已切换
    });
  </script>
</body>
</html>


